/**
 * @file adc_app_sample_ntc.c
 * @author anlada (bo.hou@en-plus.com.cn)
 * @brief 
 * @version 0.1
 * @date 2024-05-10
 * 
 * @copyright Shenzhen EN Plus Technologies Co., Ltd. 2015-2024. All rights reserved 
 * 
 */

#include "adc_app_sample_ntc.h"




stTempData_t stNtcTempData[] =
{
    {-40, 519.69000, 496.85000, 474.98000},
    {-39, 485.89000, 464.84000, 444.66000},
    {-38, 454.66000, 435.25000, 416.62000},
    {-37, 425.77000, 407.86000, 390.66000},
    {-36, 399.00000, 382.46000, 366.57000},
    {-35, 374.18000, 358.89000, 344.20000},
    {-34, 351.10000, 336.98000, 323.38000},
    {-33, 329.63000, 316.57000, 303.99000},
    {-32, 309.63000, 297.54000, 285.89000},
    {-31, 290.96000, 279.77000, 268.99000},
    {-30, 273.52000, 263.16000, 253.17000},
    {-29, 257.22000, 247.63000, 238.37000},
    {-28, 241.96000, 233.08000, 224.51000},
    {-27, 227.68000, 219.46000, 211.51000},
    {-26, 214.30000, 206.69000, 199.32000},
    {-25, 201.77000, 194.72000, 187.89000},
    {-24, 190.02000, 183.49000, 177.16000},
    {-23, 179.01000, 172.96000, 167.09000},
    {-22, 168.69000, 163.08000, 157.64000},
    {-21, 159.00000, 153.81000, 148.77000},
    {-20, 149.92000, 145.11000, 140.44000},
    {-19, 141.41000, 136.95000, 132.61000},
    {-18, 133.42000, 129.29000, 125.27000},
    {-17, 125.93000, 122.10000, 118.37000},
    {-16, 118.90000, 115.35000, 111.89000},
    {-15, 112.31000, 109.01000, 105.80000},
    {-14, 106.12000, 103.06000, 100.08000},
    {-13, 100.31000,  97.47000,  94.70000},
    {-12,  94.85000,  92.22000,  89.65000},
    {-11,  89.72000,  87.28000,  84.90000},
    {-10,  84.91000,  82.64000,  80.43000},
    { -9,  80.38000,  78.28000,  76.23000},
    { -8,  76.13000,  74.18000,  72.27000},
    { -7,  72.12000,  70.32000,  68.54000},
    { -6,  68.36000,  66.68000,  65.03000},
    { -5,  64.81000,  63.25000,  61.73000},
    { -4,  61.47000,  60.03000,  58.61000},
    { -3,  58.33000,  56.99000,  55.67000},
    { -2,  55.36000,  54.12000,  52.89000},
    { -1,  52.57000,  51.41000,  50.27000},
    {  0,  49.93400,  48.86000,  47.80300},
    {  1,  47.44400,  46.44700,  45.46500},
    {  2,  45.09300,  44.16700,  43.25600},
    {  3,  42.87200,  42.01300,  41.16600},
    {  4,  40.77300,  39.97500,  39.19000},
    {  5,  38.78800,  38.04800,  37.31900},
    {  6,  36.91100,  36.22500,  35.54800},
    {  7,  35.13600,  34.49900,  33.87100},
    {  8,  33.45500,  32.86500,  32.28200},
    {  9,  31.86300,  31.31600,  30.77600},
    { 10,  30.35600,  29.84900,  29.34800},
    { 11,  28.92800,  28.45900,  27.99400},
    { 12,  27.57500,  27.14000,  26.71000},
    { 13,  26.29200,  25.89000,  25.49100},
    { 14,  25.07500,  24.70300,  24.33500},
    { 15,  23.92100,  23.57700,  23.23600},
    { 16,  22.82600,  22.50900,  22.19300},
    { 17,  21.78700,  21.49400,  21.20300},
    { 18,  20.80100,  20.53100,  20.26200},
    { 19,  19.86500,  19.61500,  19.36700},
    { 20,  18.97500,  18.74500,  18.51700},
    { 21,  18.13000,  17.91900,  17.70800},
    { 22,  17.32800,  17.13300,  16.93900},
    { 23,  16.56500,  16.38600,  16.20800},
    { 24,  15.84000,  15.67600,  15.51200},
    { 25,  15.15000,  15.00000,  14.85000},
    { 26,  14.50700,  14.35700,  14.20700},
    { 27,  13.89500,  13.74500,  13.59600},
    { 28,  13.31200,  13.16300,  13.01400},
    { 29,  12.75700,  12.60800,  12.46100},
    { 30,  12.22800,  12.08000,  11.93400},
    { 31,  11.72300,  11.57700,  11.43200},
    { 32,  11.24300,  11.09800,  10.95400},
    { 33,  10.78500,  10.64200,  10.49900},
    { 34,  10.34800,  10.20600,  10.06600},
    { 35,   9.93170,   9.79150,   9.65240},
    { 36,   9.53430,   9.39590,   9.25850},
    { 37,   9.15510,   9.01850,   8.88300},
    { 38,   8.79320,   8.65840,   8.52480},
    { 39,   8.44760,   8.31480,   8.18320},
    { 40,   8.11760,   7.98680,   7.85720},
    { 41,   7.80250,   7.67360,   7.54610},
    { 42,   7.50130,   7.37450,   7.24910},
    { 43,   7.21360,   7.08880,   6.96550},
    { 44,   6.93850,   6.81580,   6.69470},
    { 45,   6.67550,   6.55490,   6.43590},
    { 46,   6.42400,   6.30550,   6.18860},
    { 47,   6.18340,   6.06700,   5.95220},
    { 48,   5.95310,   5.83880,   5.72620},
    { 49,   5.73280,   5.62060,   5.51000},
    { 50,   5.52180,   5.41170,   5.30320},
    { 51,   5.31980,   5.21180,   5.10540},
    { 52,   5.12630,   5.02030,   4.91600},
    { 53,   4.94100,   4.83700,   4.73470},
    { 54,   4.76330,   4.66140,   4.56110},
    { 55,   4.59300,   4.49310,   4.39480},
    { 56,   4.42980,   4.33180,   4.23550},
    { 57,   4.27320,   4.17720,   4.08290},
    { 58,   4.12300,   4.02890,   3.93650},
    { 59,   3.97890,   3.88670,   3.79620},
    { 60,   3.84060,   3.75030,   3.66170},
    { 61,   3.70790,   3.61940,   3.53260},
    { 62,   3.58040,   3.49370,   3.40870},
    { 63,   3.45800,   3.37310,   3.28990},
    { 64,   3.34040,   3.25720,   3.17580},
    { 65,   3.22750,   3.14600,   3.06630},
    { 66,   3.11890,   3.03910,   2.96110},
    { 67,   3.01450,   2.93640,   2.86000},
    { 68,   2.91420,   2.83770,   2.76300},
    { 69,   2.81770,   2.74280,   2.66970},
    { 70,   2.72500,   2.65160,   2.58000},
    { 71,   2.63570,   2.56390,   2.49380},
    { 72,   2.54980,   2.47950,   2.41090},
    { 73,   2.46710,   2.39830,   2.33120},
    { 74,   2.38760,   2.32020,   2.25450},
    { 75,   2.31100,   2.24500,   2.18080},
    { 76,   2.23720,   2.17270,   2.10980},
    { 77,   2.16610,   2.10300,   2.04140},
    { 78,   2.09770,   2.03590,   1.97570},
    { 79,   2.03180,   1.97120,   1.91230},
    { 80,   1.96820,   1.90900,   1.85130},
    { 81,   1.90700,   1.84900,   1.79260},
    { 82,   1.84800,   1.79120,   1.73600},
    { 83,   1.79110,   1.73550,   1.68150},
    { 84,   1.73620,   1.68180,   1.62890},
    { 85,   1.68330,   1.63000,   1.57830},
    { 86,   1.63220,   1.58010,   1.52950},
    { 87,   1.58290,   1.53190,   1.48240},
    { 88,   1.53540,   1.48550,   1.43700},
    { 89,   1.48960,   1.44070,   1.39320},
    { 90,   1.44530,   1.39740,   1.35100},
    { 91,   1.40250,   1.35570,   1.31020},
    { 92,   1.36130,   1.31540,   1.27090},
    { 93,   1.32140,   1.27650,   1.23300},
    { 94,   1.28290,   1.23900,   1.19640},
    { 95,   1.24580,   1.20270,   1.16100},
    { 96,   1.20990,   1.16770,   1.12690},
    { 97,   1.17520,   1.13390,   1.09390},
    { 98,   1.14160,   1.10120,   1.06210},
    { 99,   1.10920,   1.06960,   1.03130},
    {100,   1.07790,   1.03910,   1.00160},
    {101,   1.04760,   1.00960,   0.97288},
    {102,   1.01830,   0.98108,   0.94514},
    {103,   0.98995,   0.95351,   0.91832},
    {104,   0.96255,   0.92685,   0.89239},
    {105,   0.93604,   0.90107,   0.86733},
    {106,   0.91039,   0.87614,   0.84309},
    {107,   0.88557,   0.85201,   0.81964},
    {108,   0.86156,   0.82867,   0.79697},
    {109,   0.83830,   0.80609,   0.77503},
    {110,   0.81579,   0.78423,   0.75381},
    {111,   0.79400,   0.76307,   0.73327},
    {112,   0.77289,   0.74258,   0.71339},
    {113,   0.75245,   0.72275,   0.69415},
    {114,   0.73265,   0.70354,   0.67552},
    {115,   0.71347,   0.68494,   0.65748},
    {116,   0.69488,   0.66691,   0.64001},
    {117,   0.67687,   0.64946,   0.62309},
    {118,   0.65941,   0.63254,   0.60670},
    {119,   0.64249,   0.61614,   0.59082},
    {120,   0.62609,   0.60026,   0.57543},
    {121,   0.61018,   0.58485,   0.56052},
    {122,   0.59476,   0.56992,   0.54607},
    {123,   0.57979,   0.55544,   0.53206},
    {124,   0.56528,   0.54140,   0.51847},
    {125,   0.55120,   0.52778,   0.50530},
};
#define cNtcDataNum   (sizeof(stNtcTempData)/sizeof(stTempData_t))




/**
 * @brief 计算NTC温度值
 * 
 * @param f32Ohm NTC电阻值
 * @param pTemp NTC温度值
 * @return true 
 * @return false 
 * @version 0.1
 * @author anlada (bo.hou@en-plus.com.cn)
 * @date 2024-05-10
 */
bool sGetNtcTemp(f32 f32Ohm, f32* pTemp)
{
    u32 u32Index = 0;
    bool bRet = false;
    for(; u32Index < cNtcDataNum; u32Index++)
    {
       if(f32Ohm >= (stNtcTempData[u32Index].f32Rnor * 1000.0f))
        {
            *pTemp = stNtcTempData[u32Index].f32Temp + (((stNtcTempData[u32Index].f32Rnor * 1000.0f) - f32Ohm) / ((stNtcTempData[u32Index].f32Rnor * 1000.0f) - (stNtcTempData[u32Index + 1].f32Rnor * 1000.0f)));
            bRet = true;
            break;
        }
    }
    
    if(false == bRet)
    {
        //电阻值很大，说明NTC可能断路或温度低于-40度
        *pTemp = -40.0f;
    }
    return bRet;
}